<div class="page-container" >
  
  
  <div [ngClass]="{'content-container-restaurant': getRestaurant, 'content-container': !getRestaurant}">
    <div class="main-action-area">
      <button class="food-button pulse-animation" (click)="onClick()" [class.loading]="isLoading" [class.selected]="foodSelected">
        <span *ngIf="!isLoading && !foodSelected" class="initial-text">
          <ion-icon name="restaurant-outline"></ion-icon>
          <span>Find Food</span>
        </span>
        
        <div *ngIf="isLoading" class="loading-container">
          <div class="loading-spinner"></div>
          <span class="loading-text">Finding deliciousness...</span>
        </div>
        
        <div *ngIf="foodSelected && !isLoading" class="food-content">
          
            <ng-container *ngIf="selectedFood.imageLink; else placeholderImage">
              <div class="food-image-container">
                  <img [src]="selectedFood.imageLink" [alt]="selectedFood.name || 'Food'">
              </div>
            
            </ng-container>
           <ng-template #placeholderImage>
              <span class="initial-text">
                <ion-icon name="restaurant-outline"></ion-icon>
              </span>
              
            </ng-template>
          <span class="food-name">{{selectedFood.name}}</span>
        </div>
      </button>
      
      <div *ngIf="foodSelected && !isLoading" class="actions">
        <button class="action-button find-restaurant" (click)="findRestaurants()">
          <ion-icon name="location-outline"></ion-icon>
          <span>Find Restaurants</span>
        </button>
        
        <button class="action-button save-food" (click)="saveFood()">
          <ion-icon name="bookmark-outline"></ion-icon>
          <span>Save Food</span>
        </button>
      </div>
    </div>
    
    <div *ngIf="getRestaurant">
      <ng-container *ngIf="restaurants.length > 0; else noRestaurant" class="restaurants-section">
        <h2>Nearby Restaurants</h2>
        <div class="restaurant-list">
          <div *ngFor="let restaurant of restaurants" class="restaurant-card">
            <div class="restaurant-image">
              <img [src]="restaurant.photoLink || selectedFood.imageLink" 
              alt="{{restaurant.name}}"
              (error)="handleImageError($event)"
              >
            </div>
            <div class="restaurant-details">
              <div class="restaurant-title">
                <h3>{{restaurant.name}}</h3>
              </div>
              
              
              <div *ngIf="restaurant.rating" class="rating">
                <div class="stars">
                  <ion-icon *ngFor="let star of [1,2,3,4,5];" 
                            [name]="(star <= restaurant.rating) ? 'star' : (star - 0.5 <= restaurant.rating ? 'star-half' : 'star-outline')">
                  </ion-icon>
                </div>
                <span class="rating-number">{{restaurant.rating}}</span>
              </div>
              <!-- template for price range placeholder -->
              <div class="price-range">
                <span class="price-label">
                  <ng-container *ngIf="restaurant.priceRange?.startPrice?.units != null && restaurant.priceRange?.endPrice?.units != null; else placeholder">
                    {{ restaurant.priceRange.startPrice.currencyCode }}
                    {{ restaurant.priceRange.startPrice.units }}
                    -
                    {{ restaurant.priceRange.endPrice.units }}
                  </ng-container>
                  <ng-template #placeholder>
                    Price not available
                  </ng-template>
                </span>
              </div>
              <div class="open-status">
                Status: 
                <span class="status-color">Open</span>
              </div>
              <a [href]="'https://www.google.com/maps/place/?q=:' + restaurant.name" 
                target="_blank" 
                class="view-button">
                <ion-icon name="map-outline"></ion-icon>
                View on Maps
              </a>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
    

    <ng-template #noRestaurant>
      <div class="restaurants-section">
        <h2>Nearby Restaurants</h2>
        <h3>No restaurant found, try again later</h3>
      </div>
    </ng-template>
  </div>

  <!-- Saved Foods Modal -->
<div *ngIf="isModalOpen" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">

      <h2>Saved Foods</h2>
      <button class="close-button" (click)="closeModal()">
        <ion-icon name="close-outline"></ion-icon>
      </button>
    </div>
    
    <div class="modal-body">
      <div *ngIf="savedFoods.length === 0" class="no-foods">
        <ion-icon name="bookmark-outline"></ion-icon>
        <p>No saved foods yet</p>
      </div>
      
      <div *ngIf="savedFoods.length > 0" class="saved-foods-grid">
        <div *ngFor="let food of savedFoods" class="saved-food-item" (click)="chooseSavedFood(food)">
          <button class="delete-button" (click)="confirmDelete(food, $event)">
            <ion-icon name="close-outline"></ion-icon>
          </button>
          <div class="food-thumbnail">
            <img [src]="food.imageLink" [alt]="food.name">
          </div>
          <span class="food-name">{{food.name}}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="isDeleteModalOpen" class="modal-overlay" (click)="cancelDelete()">
  <div class="delete-modal-content" (click)="$event.stopPropagation()">
    <div class="delete-modal-header">
      <h3>Delete Food</h3>
    </div>
    <div class="delete-modal-body">
      <p>Are you sure you want to remove <strong>{{foodToDelete?.name}}</strong> from your saved foods?</p>
    </div>
    <div class="delete-modal-actions">
      <button class="cancel-btn" (click)="cancelDelete()">Cancel</button>
      <button class="delete-btn" (click)="deleteFood()" [disabled]="isDeletingFood">
        <span *ngIf="!isDeletingFood">Delete</span>
        <div *ngIf="isDeletingFood" class="spinner"></div>
      </button>
    </div>
  </div>
</div>


</div>

<ion-footer class="ion-no-border">
  <div class="app-footer">
    <div class="footer-content">
      <app-account 
      (isLoggedInEvent)="isLoggedInCheck($event)"
      [openLoginModalEvent]="openLoginModal"
      (savedFoodEvent)="savedFoodCheck($event)"
      [savedFoodLoadingEvent]="savedFoodLoading"
      ></app-account>

      <div class="logo-section">
        <h1>Lunchpot</h1>
        <p class="tagline">Discover your next delicious meal</p>
      </div>
      
      

    </div>
  </div>
</ion-footer>